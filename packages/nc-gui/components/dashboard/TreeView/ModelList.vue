<script lang="ts" setup>
import type { BaseType } from 'nocodb-sdk'

import catalog from '../../../assets/img/catalog.svg'
import { useChatPlaygroundViewStore } from '../../../store/chatPlaygroundView'

const props = defineProps<{
  base: BaseType
  setIsLoadingModel: (value: boolean) => void
}>()

onMounted(async () => {
  layoutLfetHeaderElem.value = document.querySelector('.layout-left-header')
  layoutLfetFooterElem.value = document.querySelector('.layout-left-footer')
  props.setIsLoadingModel(true)
  props.base && (await loadProjectTables(props.base.id as string))
  props.setIsLoadingModel(false)
})

const { loadProjectTables } = useTablesStore()
const { openTable: _openTable } = useTableNew({ baseId: props.base.id! })
const { $api } = useNuxtApp()
const route = useRoute()
const store = useChatPlaygroundViewStore()
const { chataiData } = storeToRefs(store)
const { moveModel, moveCatalog } = store
const expandedKeys = ref([])
const isShowLoading = ref(false)
const modelTreeRef = ref<any>(null)
const layoutLfetHeaderElem = ref<any>(null)
const layoutLfetFooterElem = ref<any>(null)
const { isLeftSidebarOpen } = storeToRefs(useSidebarStore())
const scrollYHeight = ref(0)
const { search } = useFieldQuery()
const modelTreeData = computed(() => {
  if (modelTreeRef.value) resizeObserver.observe(modelTreeRef.value)
  if (!layoutLfetHeaderElem.value) layoutLfetHeaderElem.value = document.querySelector('.layout-left-header')
  if (!layoutLfetFooterElem.value) layoutLfetFooterElem.value = document.querySelector('.layout-left-footer')
  return chataiData.value.modelTree.length ? chataiData.value.modelTree[0].children : []
})

const openedTableId = computed(() => {
  return route && route?.params && route.params?.viewId ? route.params?.viewId : ''
})

const otherContentHeight = computed(() => {
  if (layoutLfetHeaderElem.value && layoutLfetFooterElem.value)
    return Math.ceil(layoutLfetHeaderElem.value.offsetHeight + layoutLfetFooterElem.value.offsetHeight) + 73
  return 0
})

//监听模型树内容高度变化
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.target === modelTreeRef.value) {
      scrollYHeight.value = parseInt(`${entry.contentRect.height}`)
    }
  }
})

const onClickToTableView = (item: any) => {
  if (item.key.indexOf('Empty') > -1) return
  search.value.queryModelSearchParams = []
  _openTable({
    ...item,
    base_id: props.base.id,
    id: item.id,
    title: item.name_cn,
    table_name: item.name,
    type: 'table',
  })
}

const handleExpand = (expandedKeys1: any, e: any) => {
  if (e.expanded) {
    expandedKeys.value.push(e.node.id)
  } else {
    expandedKeys.value = expandedKeys.value.filter((item) => item !== e.node.id)
  }
}

const handleClickCatalog = (catalog: any) => {
  if (expandedKeys.value.includes(catalog.id)) {
    expandedKeys.value = expandedKeys.value.filter((item) => item !== catalog.id)
  } else {
    expandedKeys.value.push(catalog.id)
  }
}

const onDragEnter = (info: any) => {
  if (info.node.isCatalog && !expandedKeys.value.includes(info?.node?.id)) {
    expandedKeys.value.push(info.node.id)
  }
}

const onDrop = async (info: any) => {
  try {
    isShowLoading.value = true
    if (info.dragNode.isCatalog) {
      await dropCatalog(info)
    } else {
      await dropModel(info)
    }
  } catch (error) {
    console.error(error)
  } finally {
    isShowLoading.value = false
  }
}

const dropModel = async (info: any) => {
  console.log('info', info)
  const dropPosition = info.dropPosition
  //拖拽节点
  const dragNode = info.dragNode
  //拖拽节点id
  const dragNodeKey = dragNode.key
  //拖拽节点的父级id
  const dragNodeParentId = dragNode.parentId
  //目标节点
  let dropNode = info.node
  //模型新的父级id
  let newParentId = dropNode.parentId
  console.log('newParentId', newParentId)
  if (Number(dropPosition) < 0 || !newParentId) {
    newParentId = '__root__'
  }
  let prependToTableId = dropNode.isCatalog ? '' : dropNode.key
  if (Number(dropPosition) < 0 || prependToTableId.indexOf('Empty') > -1) prependToTableId = ''
  let params = {
    baseId: props.base.id,
    catalogId: newParentId, //调整到哪个目录ID下，若传空则认为在原目录下调整位置
    tableId: dragNodeKey, //要调整位置的表ID
    prependToTableId, //要插入到哪个表ID前，若传空则插入到目录的最后
  }
  moveModel(dragNodeKey, dragNodeParentId, newParentId === '__root__' ? null : newParentId, prependToTableId)
  await $api.smartData.moveModel(params)
}

const dropCatalog = async (info: any) => {
  console.log('info', info)
  const dropPosition = info.dropPosition
  //拖拽对象
  const dragNode = info.dragNode
  //拖拽对象id
  const dragNodeKey = dragNode.key
  //拖拽对象的父级id
  const dragNodeParentId = dragNode.parentId
  //目标节点
  let dropNode = info.node
  //目录新的父级id
  let newParentId = dropNode.parentId
  newParentId = info.dropPosition < 0 ? null : newParentId
  let prependToTableId = dropNode.isCatalog ? dropNode.key : null
  prependToTableId = dropPosition < 0 ? null : prependToTableId
  let params = {
    sourceCatalogId: dragNodeKey, //源目录id
    targetCatalogId: prependToTableId ?? newParentId, //目标移动目录id
    ismoveCustomCatalogLast: !prependToTableId,
  }
  await $api.smartData.moveCatalog(params)
  moveCatalog(dragNodeKey, dragNodeParentId, newParentId, prependToTableId)
}
</script>

<template>
  <div
    ref="modelTreeRef"
    class="model-list rounded-md w-full"
    :style="{ height: `calc(${isLeftSidebarOpen ? '100vh' : '79vh'}  - ${otherContentHeight}px)` }"
  >
    <a-tree
      :height="scrollYHeight"
      :tree-data="modelTreeData"
      v-model:expandedKeys="expandedKeys"
      @expand="handleExpand"
      draggable
      @drop="onDrop"
      @dragenter="onDragEnter"
    >
      <template #title="item">
        <a-tooltip :title="item.title">
          <div v-if="item.isCatalog" class="model-text-content pr-1 hover-set" @click="handleClickCatalog(item)">
            <div class="table-name">
              <img :src="catalog" width="16" height="16" class="catlog-img" />
              <span class="mode-text"> {{ item.title }}</span>
            </div>
            <div class="flex more-action-btn more-acttion-btn-to-catalog">
              <DashboardTreeViewModelListDropDown :item="item" :base="base" :isCatalogDropDown="true" />
              <DashboardTreeViewModelListAddDropDown :item="item" :base="base" />
            </div>
          </div>
          <div
            v-else
            class="model-text-content pr-1"
            :class="{
              'background-set': item.key.indexOf('Empty') === -1 && openedTableId === item.id,
              'hover-set': item.key.indexOf('Empty') === -1,
              'cursor-style': item.key.indexOf('Empty') > -1,
            }"
            @click="onClickToTableView(item)"
          >
            <div class="table-name">
              <div v-if="item.key.indexOf('Empty') === -1">
                <template v-if="item?.code.indexOf('query_model') > -1">
                  <GeneralBaseIcon :style="{ marginRight: '2px', position: 'relative', top: '-4px' }">
                    <svg
                      t="1726824143102"
                      class="icon"
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="24285"
                      width="16"
                      height="16"
                    >
                      <path
                        d="M816.670537 280.575832c-0.342016 1.392639-0.729088 2.777086-1.140735 4.159486-0.124928 0.4096-0.251904 0.817152-0.380928 1.226751-0.311296 1.001471-0.64512 2.002943-0.993279 3.000318-0.145408 0.41984-0.288768 0.839679-0.44032 1.257471-0.135168 0.366592-0.288768 0.731136-0.428032 1.097727-0.356352 0.944127-0.710656 1.890303-1.099775 2.830334-0.135168 0.32768-0.28672 0.653312-0.425984 0.980991-0.299008 0.698368-0.616448 1.394687-0.931839 2.088959-0.137216 0.299008-0.264192 0.602112-0.403456 0.901119-0.256 0.550912-0.520192 1.097727-0.78848 1.646591-0.116736 0.239616-0.241664 0.475136-0.360448 0.714752-0.284672 0.569344-0.565248 1.138687-0.862207 1.705983-0.282624 0.54272-0.555008 1.085439-0.847871 1.624063-0.135168 0.253952-0.288768 0.503808-0.425984 0.75776-0.50176 0.911359-1.005567 1.820671-1.538047 2.727934-0.376832 0.641024-0.772096 1.277951-1.163263 1.914879-0.380928 0.618496-0.761856 1.236991-1.153023 1.851391-0.458752 0.7168-0.923647 1.431551-1.400831 2.144255-0.335872 0.50176-0.681984 1.001471-1.026047 1.501183-0.903167 1.312767-1.839103 2.617342-2.80371 3.915774-0.008192 0.01024-0.016384 0.022528-0.024576 0.032768-0.966655 1.298431-1.961983 2.590718-2.990078 3.874814-0.094208 0.116736-0.186368 0.231424-0.280576 0.346112-0.190464 0.237568-0.380928 0.473088-0.571392 0.710656-0.688128 0.841727-1.380351 1.679359-2.093055 2.51699-0.053248 0.063488-0.110592 0.126976-0.165888 0.190464-0.137216 0.159744-0.278528 0.319488-0.417792 0.48128-1.583103 1.835007-3.225598 3.659774-4.933629 5.464061-0.008192 0.008192-0.016384 0.016384-0.024576 0.026624-3.301374 3.487742-6.834172 6.91814-10.590202 10.291194-0.012288 0.008192-0.022528 0.018432-0.032768 0.026624-1.791999 1.609727-3.641342 3.205118-5.535741 4.786173l-0.497664 0.413696c-3.942398 3.27475-8.116219 6.483964-12.478457 9.633786 21.485555 4.683773 42.164199 11.546617 61.779931 20.37554L819.199816 280.575832 816.670537 280.575832z"
                        fill="#717789"
                        p-id="24286"
                      ></path>
                      <path
                        d="M0.452915 193.066892c8.679419 83.584974 141.070251 152.61482 316.643138 170.852249 18.579445 1.929215 37.642217 3.291134 57.09411 4.040702C385.85966 368.410403 397.670469 368.639779 409.600061 368.639779c3.975166 0 7.940091-0.026624 11.888633-0.075776 27.645935-0.354304 54.603743-1.941503 80.615376-4.644861 32.413677-3.36691 63.344602-8.472571 92.307401-15.073271 2.476031-0.565248 4.935677-1.140735 7.383036-1.726463 18.866165-4.519933 36.855786-9.682938 53.81936-15.427575 3.293182-1.114111 6.5495-2.250751 9.764858-3.409918 6.92838-2.494463 13.678584-5.085181 20.226036-7.774203 4.665341-1.916927 9.222138-3.885054 13.688824-5.89414 4.425725-1.992703 8.747003-4.03251 12.969976-6.113276 1.912831-0.944127 3.803134-1.896447 5.675005-2.859006 6.256636-3.215358 12.283897-6.526972 18.038773-9.934842 0.067584-0.04096 0.135168-0.083968 0.206848-0.124928 8.294395-4.921341 16.05631-10.037242 23.238642-15.329271 1.742847-1.284095 3.440638-2.582526 5.113853-3.887102 6.674428-5.199869 12.81228-10.557434 18.354165-16.062454 1.415167-1.406975 2.781182-2.826238 4.120574-4.251645 5.218301-5.552125 9.861114-11.241465 13.869048-17.055734 1.939455-2.811902 3.713022-5.656573 5.357565-8.525819 1.806335-3.153918 3.43859-6.336508 4.878333-9.553914 0.804864-1.794047 1.544191-3.600382 2.232319-5.414909 2.777086-7.340028 4.610045-14.825463 5.400573-22.433779 0.137216-1.327103 0.243712-2.656254 0.319488-3.99155C819.156808 187.496336 819.199816 185.909136 819.199816 184.319889c0-101.797827-183.383954-184.319889-409.599754-184.319889S0.000307 82.522062 0.000307 184.319889c0 1.589247 0.045056 3.176446 0.13312 4.757501C0.209203 190.410638 0.315699 191.741837 0.452915 193.066892z"
                        fill="#717789"
                        p-id="24287"
                      ></path>
                      <path
                        d="M458.485792 879.304176c-3.70483 0.196608-7.407612 0.395264-11.141113 0.550912-0.983039 0.04096-1.970175 0.079872-2.955262 0.118784-5.187581 0.196608-10.395642 0.352256-15.636471 0.4608-0.864255 0.02048-1.732607 0.03072-2.596862 0.045056C420.661303 880.575984 415.14809 880.639472 409.600061 880.639472s-11.061241-0.063488-16.556022-0.161792c-0.864255-0.016384-1.732607-0.026624-2.596862-0.045056-5.238781-0.108544-10.44889-0.264192-15.634423-0.4608-0.987135-0.038912-1.972223-0.077824-2.95731-0.118784-5.232637-0.21504-10.440698-0.466944-15.613943-0.770048-0.632832-0.036864-1.261567-0.079872-1.892351-0.120832-5.154813-0.311296-10.280954-0.663552-15.372279-1.062911-0.38912-0.03072-0.782336-0.057344-1.173503-0.088064-5.206013-0.413696-10.369018-0.882687-15.505399-1.384447-0.849919-0.08192-1.699839-0.16384-2.545662-0.249856-5.019645-0.503808-10.002426-1.052671-14.948343-1.640447-0.786432-0.09216-1.570815-0.190464-2.355199-0.28672-5.113853-0.622592-10.196986-1.277951-15.228919-1.986559-0.155648-0.02048-0.309248-0.043008-0.464896-0.067584-5.074941-0.7168-10.10073-1.482751-15.087607-2.283519-0.487424-0.079872-0.976895-0.1536-1.462271-0.231424-4.890621-0.796672-9.730042-1.640447-14.532599-2.51699-0.708608-0.129024-1.415167-0.260096-2.119679-0.391168-4.794365-0.888831-9.54777-1.814527-14.249975-2.78323-0.464896-0.094208-0.925695-0.19456-1.390591-0.292864-9.791482-2.035711-19.369972-4.241405-28.725231-6.608892-0.456704-0.116736-0.913407-0.227328-1.368063-0.344064-4.536317-1.159167-9.015291-2.355199-13.441016-3.588094-0.509952-0.14336-1.017855-0.28672-1.525759-0.428032-4.503549-1.267711-8.955899-2.566142-13.340664-3.907582-0.11264-0.036864-0.223232-0.07168-0.33792-0.106496-4.564989-1.402879-9.068539-2.842622-13.500408-4.321277-0.0512-0.016384-0.1024-0.032768-0.151552-0.049152-4.286461-1.433599-8.497147-2.910206-12.654584-4.415485-0.23552-0.086016-0.48128-0.16384-0.7168-0.249856l0.026624 0c-81.715151-29.751278-137.476014-73.35522-149.643174-122.879926L0.000307 716.797522l0 122.879926c0 82.675662 120.962999 152.637348 287.592275 176.002966l0 0c0.016384 0.002048 0.034816 0.004096 0.049152 0.006144 4.292605 0.602112 8.624123 1.161215 12.97612 1.701887 1.054719 0.129024 2.109439 0.258048 3.166206 0.385024 4.308989 0.518144 8.634363 1.013759 12.998648 1.470463 0.063488 0.006144 0.124928 0.014336 0.188416 0.02048 4.421629 0.4608 8.878075 0.876543 13.355 1.271807 1.089535 0.096256 2.179071 0.190464 3.270654 0.282624 4.440061 0.374784 8.894459 0.72704 13.383672 1.038335 0.053248 0.004096 0.106496 0.008192 0.161792 0.012288 4.528125 0.311296 9.091067 0.577536 13.668344 0.821248 1.128447 0.06144 2.258943 0.120832 3.389438 0.176128 4.562941 0.22528 9.140219 0.43008 13.748216 0.587776 0.032768 0.002048 0.065536 0.004096 0.098304 0.004096 4.624381 0.159744 9.277434 0.270336 13.942776 0.360448 1.169407 0.022528 2.340863 0.043008 3.512318 0.059392 4.683773 0.069632 9.377786 0.120832 14.098424 0.120832s9.416698-0.049152 14.098424-0.120832c1.171455-0.018432 2.342911-0.038912 3.512318-0.059392 4.665341-0.090112 9.318394-0.200704 13.942776-0.360448 0.032768 0 0.065536-0.002048 0.098304-0.004096 4.607997-0.157696 9.185274-0.362496 13.750264-0.587776 1.130495-0.055296 2.260991-0.114688 3.38739-0.176128 4.577277-0.243712 9.140219-0.509952 13.67244-0.821248 0.049152-0.004096 0.098304-0.008192 0.149504-0.012288 4.493309-0.309248 8.953851-0.663552 13.398008-1.038335 1.089535-0.09216 2.177023-0.186368 3.262462-0.282624 4.478973-0.395264 8.937467-0.811008 13.361144-1.271807 0.055296-0.006144 0.114688-0.012288 0.172032-0.018432 4.368381-0.456704 8.699899-0.954367 13.012984-1.472511 1.054719-0.126976 2.107391-0.253952 3.160062-0.385024 4.351997-0.540672 8.685563-1.099775 12.980216-1.701887 0.016384-0.002048 0.034816-0.004096 0.049152-0.006144 52.762592-7.397372 100.935619-19.47442 142.149547-35.141611C588.82453 976.16223 512.677888 938.012109 458.485792 879.304176z"
                        fill="#717789"
                        p-id="24288"
                      ></path>
                      <path
                        d="M0.213299 627.248776c0.065536 0.980991 0.14336 1.959935 0.243712 2.938878 0.053248 0.526336 0.116736 1.050623 0.180224 1.574911 0.11264 0.927743 0.239616 1.853439 0.382976 2.779134 0.079872 0.514048 0.157696 1.028095 0.247808 1.540095 0.172032 0.997375 0.370688 1.994751 0.577536 2.985982 0.086016 0.41984 0.165888 0.839679 0.258048 1.257471 0.315392 1.406975 0.659456 2.805758 1.046527 4.202493 0.038912 0.139264 0.086016 0.278528 0.124928 0.417792 0.352256 1.253375 0.733184 2.504702 1.142783 3.751934 0.147456 0.452608 0.311296 0.901119 0.466944 1.351679 0.325632 0.942079 0.661504 1.884159 1.017855 2.820094 0.190464 0.499712 0.385024 0.995327 0.585728 1.492991 0.364544 0.911359 0.743424 1.820671 1.136639 2.725886 0.206848 0.475136 0.411648 0.954367 0.62464 1.427455 0.456704 1.007615 0.935935 2.013183 1.429503 3.016702 0.17408 0.352256 0.33792 0.708608 0.514048 1.060863 0.68608 1.357823 1.402879 2.709502 2.154495 4.057086 0.11264 0.200704 0.23552 0.39936 0.34816 0.600064 0.64512 1.140735 1.312767 2.275327 2.004991 3.40787 0.258048 0.41984 0.528384 0.837631 0.792576 1.257471 0.579584 0.917503 1.169407 1.835007 1.777663 2.748414 0.303104 0.454656 0.612352 0.907263 0.923647 1.361919 0.620544 0.905215 1.259519 1.806335 1.910783 2.705406 0.303104 0.417792 0.602112 0.837631 0.913407 1.253375 0.77824 1.050623 1.583103 2.095103 2.402303 3.137534 0.19456 0.24576 0.380928 0.495616 0.575488 0.741376 1.046527 1.312767 2.123775 2.615294 3.23379 3.911678 0.165888 0.19456 0.339968 0.385024 0.505856 0.575488 0.937983 1.083391 1.894399 2.164735 2.873342 3.237886 0.33792 0.36864 0.684032 0.735232 1.026047 1.103871 0.845823 0.909311 1.705983 1.814527 2.582526 2.715646 0.37888 0.38912 0.761856 0.780288 1.146879 1.167359 0.907263 0.915455 1.835007 1.826815 2.77299 2.734078 0.34816 0.335872 0.690176 0.671744 1.042431 1.007615 1.196031 1.136639 2.416639 2.267135 3.661822 3.391486 0.098304 0.088064 0.190464 0.178176 0.288768 0.26624 1.402879 1.257471 2.836478 2.510846 4.298749 3.751934 0.192512 0.16384 0.393216 0.325632 0.585728 0.489472 1.234943 1.040383 2.490367 2.076671 3.768318 3.106814 0.37888 0.303104 0.761856 0.606208 1.144831 0.909311 1.136639 0.903167 2.289663 1.802239 3.45907 2.695166 0.4096 0.313344 0.817152 0.626688 1.230847 0.935935 1.239039 0.935935 2.498559 1.863679 3.772414 2.787326 0.325632 0.23552 0.64512 0.47104 0.972799 0.708608 3.297278 2.365439 6.709244 4.696061 10.235898 6.987772 0.159744 0.104448 0.321536 0.206848 0.48128 0.3072 1.574911 1.019903 3.17235 2.029567 4.792317 3.033086 0.364544 0.227328 0.733184 0.452608 1.101823 0.677888 1.468415 0.901119 2.955262 1.800191 4.460541 2.689022 0.37888 0.221184 0.755712 0.446464 1.134591 0.669696 1.638399 0.960511 3.297278 1.912831 4.976637 2.856958 0.212992 0.120832 0.423936 0.241664 0.638976 0.362496 3.946494 2.209791 8.003579 4.378621 12.167161 6.502396 0.094208 0.045056 0.188416 0.094208 0.282624 0.141312 1.929215 0.980991 3.883006 1.953791 5.859324 2.91635 0.311296 0.151552 0.622592 0.301056 0.935935 0.454656 1.832959 0.888831 3.68435 1.767423 5.556221 2.63987 0.294912 0.135168 0.587776 0.274432 0.884735 0.411648 8.740859 4.046846 17.887221 7.909371 27.41656 11.583481 0.210944 0.079872 0.421888 0.161792 0.632832 0.241664 2.240511 0.860159 4.499453 1.710079 6.782972 2.54771 0.141312 0.0512 0.284672 0.106496 0.425984 0.157696 9.873402 3.618814 20.12978 7.032828 30.734318 10.231802l0.243712 0.07168c32.229357 9.705466 67.676119 17.414134 105.488321 22.716402l0 0c0.016384 0.002048 0.034816 0.004096 0.049152 0.006144 1.251327 0.176128 2.525182 0.32768 3.782654 0.495616 2.482175 0.335872 4.970493 0.663552 7.4711 0.980991 0.577536 0.07168 1.144831 0.1536 1.722367 0.22528 1.054719 0.129024 2.109439 0.258048 3.166206 0.385024 0.28672 0.034816 0.575488 0.063488 0.862207 0.098304 3.147774 0.374784 6.311932 0.731136 9.488378 1.071103 0.886783 0.096256 1.759231 0.208896 2.648062 0.299008 0.063488 0.006144 0.124928 0.014336 0.188416 0.02048 1.341439 0.139264 2.703358 0.253952 4.050942 0.385024 2.414591 0.239616 4.835325 0.47104 7.264252 0.692224 0.681984 0.06144 1.355775 0.13312 2.037759 0.19456 1.089535 0.096256 2.179071 0.190464 3.270654 0.282624 0.256 0.022528 0.516096 0.038912 0.772096 0.059392 3.655678 0.305152 7.325692 0.591872 11.014137 0.854015 0.534528 0.038912 1.062911 0.086016 1.597439 0.124928 0.053248 0.004096 0.106496 0.008192 0.161792 0.012288 1.339391 0.09216 2.697214 0.157696 4.04275 0.243712 2.488319 0.157696 4.982781 0.309248 7.483388 0.45056 0.7168 0.038912 1.425407 0.090112 2.142207 0.129024 1.128447 0.06144 2.258943 0.120832 3.389438 0.176128 0.172032 0.008192 0.344064 0.014336 0.516096 0.022528 3.747838 0.18432 7.510011 0.344064 11.286521 0.48128 0.651264 0.024576 1.292287 0.06144 1.945599 0.083968 0.032768 0.002048 0.065536 0.004096 0.098304 0.004096 1.310719 0.045056 2.635774 0.063488 3.948542 0.1024 2.482175 0.073728 4.972541 0.137216 7.467004 0.192512 0.845823 0.018432 1.681407-0.401408 2.52723-0.385024 1.169407 0.022528 2.340863-0.391168 3.512318-0.391168l0.182272 0c0.073728 0-0.41984 0.456704-0.41984 0.456704l0 0.22528c5.285885 0.055296 8.693755 0.18432 12.464121 0.217088-21.057523-42.254311-32.927724-90.03617-32.927724-140.36574 0-1.241087 0.032768-1.845247 0.047104-3.893246-0.01024 0-0.022528 0-0.034816 0-0.987135 0-1.972223 0.100352-2.95731 0.059392-5.232637-0.21504-10.440698-0.376832-15.613943-0.679936-0.632832-0.036864-1.261567-0.036864-1.892351-0.075776-5.154813-0.311296-10.280954-0.641024-15.372279-1.040383-0.38912-0.03072-0.782336-0.047104-1.173503-0.077824-5.206013-0.413696-10.369018-0.876543-15.505399-1.378303-0.849919-0.08192-1.699839-0.159744-2.545662-0.24576-5.019645-0.503808-10.002426-1.052671-14.948343-1.640447-0.786432-0.09216-1.570815-0.188416-2.355199-0.284672-5.113853-0.622592-10.196986-1.277951-15.228919-1.986559-0.155648-0.02048-0.309248-0.043008-0.464896-0.067584-5.074941-0.7168-10.10073-1.482751-15.087607-2.283519-0.487424-0.079872-0.976895-0.1536-1.462271-0.231424-4.890621-0.796672-9.730042-1.640447-14.532599-2.51699-0.708608-0.129024-1.415167-0.260096-2.119679-0.391168-4.794365-0.888831-9.54777-1.814527-14.249975-2.78323-0.464896-0.094208-0.925695-0.19456-1.390591-0.292864-9.791482-2.035711-19.369972-4.241405-28.725231-6.608892-0.456704-0.116736-0.913407-0.227328-1.368063-0.344064-4.536317-1.159167-9.015291-2.355199-13.441016-3.588094-0.509952-0.14336-1.017855-0.28672-1.525759-0.428032-4.503549-1.267711-8.955899-2.566142-13.340664-3.907582-0.11264-0.036864-0.223232-0.07168-0.33792-0.106496-4.564989-1.402879-9.068539-2.842622-13.500408-4.321277-0.0512-0.016384-0.1024-0.032768-0.151552-0.049152-4.286461-1.433599-8.497147-2.398207-12.654584-3.903486-0.059392-0.022528-0.118784-0.016384-0.178176 0.004096-0.002048 0.002048-0.006144 0.004096-0.01024 0.006144-0.165888 0.059392-0.335872 0.22528-0.499712 0.243712-0.004096 0-0.008192 0.004096-0.012288 0.004096-4.872189-1.832959-9.646074-3.710974-14.329847-5.627901-0.223232-0.09216-0.452608-0.180224-0.67584-0.272384-4.648957-1.910783-9.195514-3.866622-13.649912-5.859324-0.241664-0.108544-0.489472-0.212992-0.729088-0.319488-4.468733-2.009087-8.830971-4.061182-13.096952-6.152188-0.2048-0.1024-0.417792-0.200704-0.622592-0.299008-4.446205-2.187263-8.779771-4.419581-12.994552-6.69286-0.012288-0.006144-0.026624-0.014336-0.038912-0.02048-3.962878-2.136063-7.809019-4.313085-11.560953-6.524924-0.251904-0.147456-0.512-0.292864-0.763904-0.442368-7.964667-4.720637-15.437815-9.601018-22.384627-14.634999-0.006144-0.004096-0.012288-0.008192-0.018432-0.014336-27.623407-20.010996-46.933988-42.389479-55.791583-66.383832-1.175551-3.184638-2.179071-6.3959-2.981886-9.635834L0.000307 499.70146l0 121.855927c0 1.439743 0.045056 2.87539 0.118784 4.308989C0.141619 626.335368 0.182579 626.792072 0.213299 627.248776z"
                        fill="#717789"
                        p-id="24289"
                      ></path>
                      <path
                        d="M0.213299 409.130763c0.067584 0.985087 0.14336 1.968127 0.243712 2.949118 0.053248 0.518144 0.116736 1.036287 0.178176 1.552383 0.114688 0.940031 0.243712 1.880063 0.38912 2.815998 0.077824 0.497664 0.1536 0.993279 0.239616 1.490943 0.180224 1.042431 0.385024 2.082815 0.60416 3.12115 0.077824 0.366592 0.145408 0.735232 0.227328 1.101823 0.643072 2.869246 1.435647 5.718013 2.367487 8.548347 0.090112 0.272384 0.188416 0.540672 0.280576 0.811008 0.397312 1.169407 0.817152 2.334719 1.263615 3.495934 0.108544 0.282624 0.219136 0.5632 0.329728 0.843775 0.485376 1.232895 0.997375 2.459647 1.535999 3.682302 0.067584 0.1536 0.13312 0.3072 0.202752 0.4608 29.614062 66.234328 138.114989 119.623608 279.521112 139.452332l0 0c0.016384 0.002048 0.034816 0.004096 0.049152 0.006144 4.292605 0.602112 8.624123 1.161215 12.97612 1.701887 1.054719 0.129024 2.109439 0.258048 3.166206 0.385024 4.308989 0.518144 8.634363 1.013759 12.998648 1.470463 0.063488 0.006144 0.124928 0.014336 0.188416 0.02048 4.421629 0.4608 8.878075 0.876543 13.355 1.271807 1.089535 0.096256 2.179071 0.190464 3.270654 0.282624 4.440061 0.374784 8.894459 0.72704 13.383672 1.038335 0.053248 0.004096 0.106496 0.008192 0.161792 0.012288 4.528125 0.311296 9.091067 0.577536 13.668344 0.821248 1.128447 0.06144 2.258943 0.120832 3.389438 0.176128 0.065536 0.004096 0.129024 0.006144 0.19456 0.008192 6.68262 0.352256 13.428728 0.608256 20.20146 0.815104 14.237687-55.678943 43.327462-105.478081 82.786254-144.902057-0.845823 0.055296-1.683455 0.124928-2.531326 0.17408-0.57344 0.036864-1.146879 0.075776-1.720319 0.108544-0.057344 0.004096-0.116736 0.008192-0.17408 0.01024-1.724415 0.100352-3.467262 0.17408-5.203965 0.256-3.465214 0.180224-6.922236 0.36864-10.409978 0.512-0.864255 0.034816-1.732607 0.069632-2.600958 0.104448-0.118784 0.004096-0.237568 0.01024-0.3584 0.014336-0.116736 0.004096-0.23552 0.008192-0.352256 0.01024-5.070845 0.190464-10.160122 0.344064-15.280119 0.45056-0.864255 0.02048-1.732607 0.03072-2.596862 0.045056C420.661303 444.352245 415.14809 444.415733 409.600061 444.415733s-11.061241-0.063488-16.556022-0.161792c-0.864255-0.016384-1.732607-0.026624-2.596862-0.045056-5.240829-0.108544-10.44889-0.264192-15.634423-0.4608-0.247808-0.01024-0.493568-0.02048-0.739328-0.03072-0.739328-0.028672-1.480703-0.057344-2.217983-0.088064-3.923966-0.161792-7.817211-0.36864-11.710457-0.577536-1.296383-0.069632-2.607102-0.116736-3.901438-0.192512-0.126976-0.006144-0.253952-0.016384-0.380928-0.024576-0.505856-0.03072-1.007615-0.063488-1.513471-0.096256-1.718271-0.104448-3.411966-0.241664-5.124093-0.354304-3.420158-0.22528-6.848508-0.442368-10.239994-0.708608-0.288768-0.022528-0.575488-0.043008-0.860159-0.063488-0.106496-0.008192-0.212992-0.016384-0.319488-0.024576-2.990078-0.237568-5.941244-0.524288-8.904699-0.794624-2.203647-0.190464-4.411389-0.374784-6.594556-0.589824-0.292864-0.028672-0.585728-0.057344-0.878591-0.086016-0.557056-0.053248-1.116159-0.108544-1.671167-0.16384-5.019645-0.503808-10.002426-1.052671-14.948343-1.640447-0.37888-0.043008-0.75776-0.09216-1.134591-0.137216-0.4096-0.049152-0.8192-0.100352-1.228799-0.149504-5.109757-0.620544-10.190842-1.275903-15.218679-1.984511-0.057344-0.006144-0.11264-0.016384-0.169984-0.024576-0.100352-0.014336-0.198656-0.028672-0.299008-0.043008-2.363391-0.333824-4.685821-0.710656-7.03078-1.064959-1.214463-0.188416-2.441215-0.364544-3.655678-0.555008-1.458175-0.227328-2.942974-0.432128-4.395005-0.6656-0.489472-0.079872-0.985087-0.1536-1.476607-0.233472-1.486847-0.241664-2.940926-0.514048-4.417533-0.763904-3.381246-0.57344-6.770684-1.140735-10.11097-1.751039-0.354304-0.065536-0.70656-0.129024-1.060863-0.19456s-0.708608-0.129024-1.060863-0.196608c-4.794365-0.888831-9.54777-1.814527-14.249975-2.78323-0.464896-0.094208-0.925695-0.19456-1.390591-0.292864-4.896765-1.017855-9.738234-2.078719-14.526455-3.180542-4.788221-1.101823-9.521146-2.246655-14.200823-3.42835-0.456704-0.114688-0.913407-0.227328-1.368063-0.344064-4.536317-1.157119-9.015291-2.355199-13.441016-3.588094-0.509952-0.141312-1.017855-0.284672-1.525759-0.428032-4.503549-1.267711-8.955899-2.564094-13.340664-3.907582-0.11264-0.034816-0.223232-0.07168-0.33792-0.106496-4.564989-1.400831-9.068539-2.840574-13.500408-4.321277-0.0512-0.016384-0.1024-0.032768-0.151552-0.049152-4.286461-1.433599-8.497147-2.910206-12.654584-4.415485-0.23552-0.086016-0.48128-0.16384-0.7168-0.249856l0.026624 0c-2.945022-1.071103-5.844988-2.168831-8.722427-3.276798-0.882687-0.339968-1.751039-0.684032-2.625534-1.028095-2.033663-0.796672-4.050942-1.601535-6.049788-2.414591-0.933887-0.380928-1.863679-0.761856-2.789374-1.146879-2.078719-0.862207-4.132862-1.736703-6.17062-2.617342-0.710656-0.3072-1.431551-0.612352-2.136063-0.921599-2.75251-1.208319-5.474301-2.430975-8.148987-3.672062-0.196608-0.090112-0.387072-0.18432-0.58368-0.27648-2.463743-1.148927-4.890621-2.312191-7.28678-3.48979-0.67584-0.331776-1.341439-0.667648-2.011135-1.001471-1.972223-0.983039-3.923966-1.974271-5.847036-2.975742-0.653312-0.339968-1.306623-0.677888-1.953791-1.019903-2.213887-1.169407-4.397053-2.349055-6.547452-3.54099-0.253952-0.141312-0.512-0.278528-0.765952-0.41984-2.53747-1.417215-5.029885-2.850814-7.475196-4.302845-0.069632-0.043008-0.137216-0.083968-0.208896-0.126976-2.279423-1.355775-4.513789-2.727934-6.711292-4.112382-0.403456-0.253952-0.800768-0.509952-1.200127-0.763904-1.959935-1.247231-3.887102-2.50675-5.779453-3.778558-0.321536-0.21504-0.64512-0.428032-0.964607-0.64512-6.684668-4.530173-12.93516-9.201658-18.728949-14.002168-0.202752-0.167936-0.403456-0.335872-0.60416-0.503808-1.814527-1.515519-3.586046-3.041278-5.306365-4.581373-0.088064-0.079872-0.178176-0.157696-0.26624-0.23552-3.729406-3.34643-7.241724-6.750204-10.522618-10.209274-1.789951-1.886207-3.506174-3.792894-5.158909-5.711869-0.090112-0.104448-0.182272-0.208896-0.272384-0.313344-0.067584-0.077824-0.135168-0.155648-0.202752-0.233472-0.731136-0.856063-1.445887-1.718271-2.150399-2.582526-0.059392-0.073728-0.118784-0.145408-0.176128-0.219136-0.206848-0.256-0.413696-0.512-0.618496-0.768-1.036287-1.294335-2.039807-2.594814-3.012606-3.901438-0.01024-0.014336-0.02048-0.028672-0.03072-0.043008-0.972799-1.308671-1.914879-2.623486-2.82419-3.944446-0.335872-0.487424-0.673792-0.974847-0.999423-1.462271-0.479232-0.7168-0.948223-1.433599-1.406975-2.154495-0.387072-0.606208-0.763904-1.214463-1.136639-1.824767-0.401408-0.653312-0.806912-1.304575-1.191935-1.959935-0.534528-0.909311-1.040383-1.824767-1.544191-2.738174-0.13312-0.241664-0.27648-0.48128-0.407552-0.724992-0.303104-0.561152-0.589824-1.126399-0.882687-1.689599-0.110592-0.212992-0.212992-0.425984-0.323584-0.641024-0.294912-0.577536-0.59392-1.155071-0.876543-1.736703-0.262144-0.540672-0.52224-1.081343-0.776192-1.622015-0.083968-0.178176-0.159744-0.360448-0.241664-0.540672-0.362496-0.790528-0.720896-1.579007-1.060863-2.373631-0.151552-0.352256-0.315392-0.704512-0.462848-1.058815-0.391168-0.940031-0.743424-1.886207-1.099775-2.830334-0.139264-0.366592-0.292864-0.731136-0.425984-1.097727-0.1536-0.417792-0.294912-0.837631-0.44032-1.257471-0.34816-0.997375-0.681984-1.998847-0.993279-3.000318-0.131072-0.417792-0.262144-0.835583-0.387072-1.253375-0.407552-1.372159-0.792576-2.750462-1.132543-4.132862L0.000307 280.573784l0 122.879926c0 1.441791 0.045056 2.877438 0.118784 4.308989C0.141619 408.221451 0.182579 408.676107 0.213299 409.130763z"
                        fill="#717789"
                        p-id="24290"
                      ></path>
                      <path
                        d="M1020.288719 944.983497l-112.390077-112.388029c-0.006144 0.008192-0.014336 0.016384-0.02048 0.026624 35.553259-46.270436 56.70499-104.183745 56.70499-167.04502 0-151.562149-122.867638-274.431835-274.431835-274.431835-151.568293 0-274.433883 122.867638-274.433883 274.431835 0 151.564197 122.86559 274.431835 274.433883 274.431835 50.14525 0 97.146822-13.459448 137.600941-36.952042l117.231546 117.231546c5.707773 5.711869 15.955958 4.720637 22.888434-2.211839l50.204642-50.200546C1025.009356 960.943551 1025.99854 950.695366 1020.288719 944.983497zM479.670291 665.575025c0-116.24441 94.238663-210.481026 210.483074-210.481026 116.240314 0 210.478978 94.236615 210.478978 210.481026s-94.240711 210.478978-210.478978 210.478978C573.908955 876.05605 479.670291 781.819435 479.670291 665.575025zM903.763733 837.846537c-0.01024 0.012288-0.02048 0.024576-0.03072 0.036864C903.743253 837.871113 903.753493 837.858825 903.763733 837.846537zM833.660735 899.524068c-0.049152 0.032768-0.100352 0.063488-0.149504 0.096256C833.560383 899.587556 833.609535 899.554788 833.660735 899.524068zM839.178044 896.04247c0.083968-0.053248 0.167936-0.110592 0.251904-0.165888C839.34598 895.931878 839.262012 895.987174 839.178044 896.04247zM844.760888 892.327401c0.100352-0.069632 0.200704-0.139264 0.299008-0.208896C844.961592 892.188137 844.86124 892.257769 844.760888 892.327401zM850.249525 888.475115c0.108544-0.075776 0.21504-0.155648 0.325632-0.23552C850.466613 888.319467 850.358069 888.399339 850.249525 888.475115zM855.641906 884.495853c0.11264-0.083968 0.223232-0.172032 0.335872-0.256C855.865138 884.323821 855.754546 884.411885 855.641906 884.495853zM860.946223 880.37528c0.100352-0.077824 0.196608-0.157696 0.29696-0.23552C861.140783 880.217584 861.046575 880.297456 860.946223 880.37528zM866.141996 876.135922c0.09216-0.075776 0.182272-0.155648 0.274432-0.231424C866.324267 875.980274 866.234155 876.060146 866.141996 876.135922zM871.241512 871.761397c0.073728-0.065536 0.147456-0.13312 0.223232-0.198656C871.388968 871.628277 871.31524 871.695861 871.241512 871.761397zM876.234533 867.263992c0.055296-0.0512 0.114688-0.108544 0.172032-0.159744C876.347173 867.155448 876.289829 867.210744 876.234533 867.263992zM881.112867 862.647802c0.043008-0.043008 0.083968-0.083968 0.126976-0.124928C881.196834 862.563834 881.155875 862.604794 881.112867 862.647802zM885.87856 857.914877c0.032768-0.032768 0.06144-0.063488 0.09216-0.096256C885.94 857.851389 885.90928 857.884157 885.87856 857.914877zM899.481368 843.02183c-0.008192 0.006144-0.012288 0.014336-0.02048 0.022528C899.46908 843.036166 899.473176 843.027974 899.481368 843.02183zM895.090458 848.072195c-0.012288 0.012288-0.022528 0.024576-0.032768 0.036864C895.06793 848.094723 895.07817 848.084483 895.090458 848.072195zM890.588957 852.99968c-0.02048 0.024576-0.043008 0.047104-0.063488 0.069632C890.545949 853.046784 890.570525 853.024256 890.588957 852.99968z"
                        fill="#717789"
                        p-id="24291"
                      ></path>
                    </svg> </GeneralBaseIcon
                ></template>

                <GeneralTableIcon v-else :meta="item" class="text-gray-500" />
              </div>
              <span class="mode-text" :class="{ 'emty-style': item.key.indexOf('Empty') > -1 }">{{ item.title }}</span>
            </div>
            <div class="flex more-action-btn">
              <DashboardTreeViewModelListDropDown
                :item="{
                  ...item,
                  base_id: props.base.id,
                  id: item.id,
                  title: item.name_cn,
                  table_name: item.name,
                  type: 'table',
                  source_id: item.parentId,
                }"
                :base="base"
                :isCatalogDropDown="false"
              />
            </div>
          </div>
        </a-tooltip>
      </template>
    </a-tree>
  </div>
  <SmartdataChatPlaygroundViewCommonLoading :isShow="isShowLoading" />
</template>

<style scoped lang="scss">
.model-list {
  overflow: hidden;
  margin-top: 4px;
  .cursor-style {
    cursor: default !important;
  }
  ::v-deep .ant-tree {
    background-color: transparent;
  }
  ::v-deep .ant-tree-list-holder {
    overflow-x: hidden;
    width: 100%;
  }
  ::v-deep .ant-tree-treenode {
    width: 100% !important;
    padding-left: 27px;
    padding-bottom: 0px;
    border-radius: 6px;
    padding-right: 2px;
    border-bottom: 2px solid #f9f9fa;
    border-top: 2px solid #f9f9fa;
  }

  ::v-deep .ant-tree-treenode:has(.hover-set) {
    &:hover {
      --tw-bg-opacity: 1;
      background-color: rgba(231, 231, 233, var(--tw-bg-opacity));
    }
  }
  .nc-sidebar-node-btn {
    @apply !opacity-100 !inline-block;
    opacity: 0;
  }
  .hover-set {
    &:hover .nc-sidebar-node-btn {
      opacity: 1 !important;
    }
  }

  ::v-deep .ant-tree-treenode:has(.background-set) {
    background-color: #edf1ff !important;
  }

  ::v-deep .ant-tree-node-content-wrapper {
    padding: 0;
    font-size: 14px;
    color: rgb(0, 0, 0);
    flex: 1;
    overflow: hidden;
  }
  ::v-deep .ant-tree-drop-indicator {
    top: 3px !important;
  }
  ::v-deep .ant-tree-switcher {
    top: -1px !important;
  }
  ::v-deep .ant-tree .ant-tree-node-content-wrapper.ant-tree-node-selected {
    background-color: transparent;
  }
  ::v-deep .ant-tree .ant-tree-node-content-wrapper:hover {
    background-color: transparent;
  }
  .model-text-content {
    display: flex;
    align-items: center;
    border-radius: 4px;
    position: relative;
    padding: 2px 0;
    .more-action-btn {
      width: 24px;
      margin-left: 16px;
      align-items: center;
    }
    .more-acttion-btn-to-catalog {
      width: 48px;
    }
    .table-name {
      display: flex;
      align-items: center;
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .catlog-img {
      position: relative;
      top: -1px;
      margin-right: 6px;
    }
    .mode-text {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .emty-style {
      color: #6a7184;
    }
  }
}
</style>
